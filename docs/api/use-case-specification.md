# E-Commerce 시스템 유스케이스 명세서

## 목차

1. [개요](#개요)
2. [액터 정의](#액터-정의)
3. [상품 조회 유스케이스](#상품-조회-유스케이스)
4. [장바구니 관리 유스케이스](#장바구니-관리-유스케이스)
5. [주문 처리 유스케이스](#주문-처리-유스케이스)
6. [쿠폰 관리 유스케이스](#쿠폰-관리-유스케이스)
7. [예외 처리 유스케이스](#예외-처리-유스케이스)

---

## 개요

본 문서는 E-Commerce 시스템의 **사용자(고객) 중심 유스케이스**를 체계적으로 정의합니다.

**시스템 범위**:
- ✅ 고객(사용자)이 직접 사용하는 기능

**기반 문서**:
- `api-specification.md` - REST API 엔드포인트 정의
- `requirements.md` - 기능 및 비기능 요구사항
- `data-models.md` - 데이터 모델 및 제약조건

---

## 액터 정의

### ACT-01: 고객 (Customer)
**역할**: 상품 구매자
**주요 목표**:
- 편리한 쇼핑 경험
- 안전한 결제
- 할인 혜택 활용

**주요 활동**: 상품 조회, 장바구니 관리, 주문 생성, 쿠폰 사용

---

## 상품 조회 유스케이스

### UC-001: 상품 목록 조회

**유스케이스 ID**: UC-001
**제목**: 상품 목록 조회
**액터**: 고객
**목표**: 판매 중인 상품들을 페이지 단위로 조회하여 구매할 상품을 찾기

**사전 조건**:
- 고객이 시스템에 접속함
- 시스템에 최소 1개 이상의 상품이 존재함

**주요 흐름**:
1. 고객이 쇼핑몰 홈페이지 또는 상품 목록 페이지 접근
2. 시스템이 상품 목록 조회 (기본값: 첫 페이지, 10개)
3. 시스템이 다음 정보를 포함한 상품 목록 반환:
   - 상품명, 가격, 재고 수량, 상태, 생성 시간
   - 전체 상품 수, 전체 페이지 수, 현재 페이지 정보
4. 고객이 상품 목록 확인

**대체 흐름**:
- 2a. 고객이 특정 페이지 번호 지정
  - 시스템이 해당 페이지의 상품 목록 조회
- 2b. 고객이 정렬 기준 변경 (상품ID, 상품명, 가격, 생성일시)
  - 시스템이 지정된 정렬 기준으로 상품 정렬

**사후 조건**:
- 고객이 상품 목록을 페이지 단위로 조회함
- 구매할 상품을 선택할 수 있는 상태가 됨
- 다음 단계: UC-002 (상품 상세 조회)

**관련 API**:
- `GET /api/products?page={page}&size={size}&sort={sort}`

---

### UC-002: 상품 상세 조회

**유스케이스 ID**: UC-002
**제목**: 상품 상세 조회 (옵션 포함)
**액터**: 고객
**목표**: 특정 상품의 상세 정보와 옵션별 재고 상태를 확인하여 구매 여부 및 옵션 선택

**사전 조건**:
- 고객이 UC-001 또는 다른 경로를 통해 상품을 찾음
- 조회하려는 상품이 시스템에 존재함

**주요 흐름**:
1. 고객이 상품 목록에서 특정 상품 선택
2. 시스템이 상품의 상세 정보 조회:
   - 상품명, 설명, 가격, 총 재고, 상태, 생성 시간
3. 시스템이 모든 옵션의 재고 상태 조회 및 표시:
   - 각 옵션명 (예: "검정/M", "화이트/L")
   - 각 옵션별 현재 재고 수량
4. 고객이 옵션별 재고 상태 확인:
   - 재고 있는 옵션: 선택 가능
   - 재고 없는 옵션: 선택 불가능

**사후 조건**:
- 고객이 상품의 모든 정보와 옵션별 재고를 확인함
- 옵션 선택 및 구매 가능 여부를 판단함
- 다음 단계: UC-003 (장바구니 담기) 또는 UC-001 (목록으로 복귀)

**관련 API**:
- `GET /api/products/{product_id}`

---

### UC-003: 인기 상품 조회

**유스케이스 ID**: UC-003
**제목**: 인기 상품 조회 (TOP 5, 최근 3일)
**액터**: 고객
**목표**: 최근 3일간 인기 있는 상품 TOP 5를 빠르게 확인하여 구매 결정 참고

**사전 조건**:
- 고객이 시스템에 접속함
- 최근 3일 이내에 주문 데이터가 존재함

**주요 흐름**:
1. 고객이 "인기 상품", "베스트셀러" 등의 메뉴 선택
2. 시스템이 최근 3일간 판매 기준 TOP 5 상품 조회:
   - 기간: 현재 시간 - 3일
   - 기준: 주문 수량 합계 (내림차순)
3. 시스템이 각 상품의 현재 정보와 함께 반환:
   - 상품명, 가격, 현재 재고, 상태
   - 최근 3일 주문 수량, 순위 (1~5)
4. 고객이 인기 상품 목록 확인 및 선택

**대체 흐름**:
- 2a. 최근 3일 내 주문이 없음
  - 시스템이 빈 결과 반환

**사후 조건**:
- 고객이 인기 상품 TOP 5를 확인함
- 다음 단계: UC-002 (상품 상세 조회)

**관련 API**:
- `GET /api/products/popular`

---

## 장바구니 관리 유스케이스

### UC-004: 장바구니 조회

**유스케이스 ID**: UC-004
**제목**: 장바구니 조회
**액터**: 고객
**목표**: 현재 장바구니에 담긴 상품들과 총 가격을 확인

**사전 조건**:
- 고객이 시스템에 로그인됨
- 고객의 장바구니가 존재함

**주요 흐름**:
1. 고객이 "장바구니" 메뉴 또는 버튼 선택
2. 시스템이 고객의 장바구니 조회
3. 시스템이 다음 정보 반환:
   - 장바구니 내 아이템 개수, 총 금액
   - 각 아이템: 상품명, 옵션명, 수량, 단가, 소계 금액
4. 고객이 장바구니 내용 확인

**대체 흐름**:
- 2a. 장바구니가 비어있음
  - 시스템이 빈 장바구니 반환
  - 고객이 상품 조회로 복귀 유도

**사후 조건**:
- 고객이 현재 장바구니의 모든 아이템을 확인함
- 장바구니의 총 금액을 알게 됨
- 다음 단계: UC-005 (아이템 추가), UC-006 (수량 수정), UC-007 (아이템 제거), UC-008 (주문)

**관련 API**:
- `GET /api/carts`

---

### UC-005: 장바구니 아이템 추가

**유스케이스 ID**: UC-005
**제목**: 장바구니 아이템 추가
**액터**: 고객
**목표**: 선택한 상품과 옵션을 특정 수량으로 장바구니에 추가

**사전 조건**:
- 고객이 UC-002 (상품 상세 조회)를 통해 상품과 옵션을 확인함
- 상품 ID와 옵션 ID가 유효함

**주요 흐름**:
1. 고객이 상품 상세 페이지에서 옵션 선택 (예: "검정/M")
2. 고객이 수량 입력 (1 ~ 1000 개)
3. 고객이 "장바구니 담기" 버튼 클릭
4. 시스템이 유효성 검증:
   - 상품과 옵션이 존재하는가?
   - 수량이 유효한가? (1 ~ 1000)
5. 시스템이 현재 상품 가격 기록
6. 시스템이 장바구니에 아이템 추가 또는 기존 아이템 수량 증가:
   - 동일한 상품+옵션이 이미 있으면: 수량 증가
   - 새로운 조합이면: 새 아이템 추가
7. 시스템이 성공 메시지 반환
8. 고객이 추가 완료 알림 수신

**대체 흐름**:
- 6a. 동일한 상품+옵션이 이미 장바구니에 있음
  - 기존 아이템의 수량에 입력 수량을 더함

**예외 흐름**:
- 4a. 상품을 찾을 수 없음
  - 시스템이 오류 메시지 반환: "상품을 찾을 수 없습니다"
- 4b. 옵션을 찾을 수 없음
  - 시스템이 오류 메시지 반환: "옵션을 찾을 수 없습니다"
- 4c. 수량이 유효하지 않음
  - 시스템이 오류 메시지 반환: "수량은 1 이상 1000 이하여야 합니다"

**사후 조건**:
- 선택한 상품+옵션+수량이 장바구니에 추가됨
- **중요**: 재고는 차감되지 않음 (주문 시점에만)
- 다음 단계: UC-004 (장바구니 조회), UC-008 (주문), UC-005 (추가 계속)

**관련 API**:
- `POST /api/carts/items`

---

### UC-006: 장바구니 아이템 수량 수정

**유스케이스 ID**: UC-006
**제목**: 장바구니 아이템 수량 수정
**액터**: 고객
**목표**: 장바구니에 담긴 아이템의 수량을 변경

**사전 조건**:
- 고객이 UC-004 (장바구니 조회)을 통해 장바구니 아이템 확인
- 수정할 아이템이 장바구니에 존재함

**주요 흐름**:
1. 고객이 장바구니에서 특정 아이템의 수량 입력필드에 새로운 수량 입력 (1 ~ 1000)
2. 고객이 수량 변경 적용
3. 시스템이 수량 유효성 검증 (1 ~ 1000)
4. 시스템이 아이템 업데이트:
   - 수량 변경
   - 소계 금액 자동 계산
5. 시스템이 변경된 아이템 정보 반환
6. 고객이 총 금액 변경 확인

**예외 흐름**:
- 3a. 수량이 유효하지 않음
  - 시스템이 오류 메시지 반환

**사후 조건**:
- 장바구니 아이템의 수량이 변경됨
- 소계 금액과 장바구니 총 금액이 자동 업데이트됨
- 다음 단계: UC-004 (장바구니 조회), UC-008 (주문)

**관련 API**:
- `PUT /api/carts/items/{cart_item_id}`

---

### UC-007: 장바구니 아이템 제거

**유스케이스 ID**: UC-007
**제목**: 장바구니 아이템 제거
**액터**: 고객
**목표**: 장바구니에서 불필요한 아이템 삭제

**사전 조건**:
- 고객이 UC-004 (장바구니 조회)을 통해 아이템 확인
- 삭제할 아이템이 장바구니에 존재함

**주요 흐름**:
1. 고객이 장바구니에서 특정 아이템의 "삭제" 버튼 클릭
2. 시스템이 아이템 삭제
3. 시스템이 삭제 완료 응답
4. 프론트엔드가 아이템 제거 및 총 금액 업데이트

**사후 조건**:
- 아이템이 장바구니에서 제거됨
- 장바구니 총 금액이 자동 업데이트됨
- 다음 단계: UC-004 (장바구니 조회), UC-008 (주문)

**관련 API**:
- `DELETE /api/carts/items/{cart_item_id}`

---

## 주문 처리 유스케이스

### UC-008: 주문 생성

**유스케이스 ID**: UC-008
**제목**: 주문 생성
**액터**: 고객
**목표**: 선택한 상품을 안전하게 구매하고 결제 완료

**사전 조건**:
- 고객이 UC-004~007을 통해 장바구니 구성 완료
- 주문할 상품의 옵션이 유효함
- 모든 상품의 옵션별 재고가 충분함
- 고객의 충전 잔액이 최종 결제금액 이상

**주요 흐름**:

#### 단계 1: 검증
1. 고객이 "결제하기" 버튼 클릭
2. 시스템이 각 상품의 현재 재고 확인:
   - 옵션별 재고 >= 주문 수량 조건 검증
3. 시스템이 쿠폰 검증 (선택):
   - 쿠폰이 제공된 경우:
     - 쿠폰이 유효한가? (활성화, 유효기간 내)
     - 사용자가 이미 사용했는가?
     - 남은 발급 수량이 있는가?
4. 시스템이 최종 결제금액 계산:
   - 상품 총액 - 쿠폰 할인액
5. 시스템이 사용자 잔액 확인:
   - 잔액 >= 결제금액인가?

#### 단계 2: 거래 처리
6. 시스템이 다음을 원자적으로 처리:
   - 각 옵션별로 재고 감소
   - 사용자 잔액 차감
   - 주문 기록 생성 (스냅샷: 상품명, 옵션명, 가격)
   - 쿠폰 사용 처리 (해당 시)
   - 모든 옵션 재고가 0이면 상품 상태 "품절"로 변경
7. 시스템이 주문 완료 응답 반환:
   - 주문 ID, 주문 상태 (완료), 최종 결제금액

#### 단계 3: 비동기 처리
8. 시스템이 배송 시스템에 자동 전달 (배경에서 비동기 처리)
   - 배송 전달 실패해도 주문은 완료 상태 유지

9. 고객이 주문 완료 알림 수신

**예외 흐름**:
- 단계 1 재고 부족: UC-009 (재고 부족) 참고
- 단계 1 잔액 부족: UC-010 (잔액 부족) 참고
- 단계 1 쿠폰 무효: UC-011 (쿠폰 무효) 참고
- 단계 2 동시 충돌: UC-012 (동시 충돌) 참고

**사후 조건**:
- ✅ 주문이 생성됨 (완료 상태)
- ✅ 재고가 차감됨
- ✅ 잔액이 차감됨
- ✅ 쿠폰이 사용됨 (해당 시)
- ✅ 배송 시스템에 자동 전달 (배경 처리)
- 다음 단계: UC-013 (주문 조회)

**관련 API**:
- `POST /api/orders`

---

### UC-013: 주문 조회

**유스케이스 ID**: UC-013
**제목**: 주문 상세 조회
**액터**: 고객
**목표**: 과거에 생성한 특정 주문의 상세 정보 확인

**사전 조건**:
- 고객이 UC-008을 통해 주문을 생성함
- 조회하려는 주문이 존재함

**주요 흐름**:
1. 고객이 "주문 내역" 메뉴에서 특정 주문 선택
2. 시스템이 주문 정보 조회
3. 시스템이 다음 정보 반환:
   - 주문 ID, 주문 상태 (완료)
   - 주문 상품들: 상품명, 옵션명, 수량, 단가
   - 소계 금액, 쿠폰 할인액, 최종 결제금액
   - 주문 생성 시간
4. 고객이 주문 상세 확인

**예외 흐름**:
- 2a. 주문을 찾을 수 없음
  - 시스템이 오류 메시지 반환: "주문을 찾을 수 없습니다"

**사후 조건**:
- 고객이 과거 주문 정보를 확인함

**관련 API**:
- `GET /api/orders/{order_id}`

---

### UC-014: 주문 목록 조회

**유스케이스 ID**: UC-014
**제목**: 주문 목록 조회
**액터**: 고객
**목표**: 내가 생성한 모든 주문들을 페이지 단위로 확인

**사전 조건**:
- 고객이 로그인됨
- 고객의 주문 이력이 있음

**주요 흐름**:
1. 고객이 "주문 내역" 메뉴 선택
2. 시스템이 고객의 주문 목록 조회:
   - 페이지: 0부터 시작 (기본값)
   - 크기: 10개 (기본값)
   - 상태 필터 (선택): 완료, 대기, 실패
3. 시스템이 주문 목록 반환:
   - 각 주문: 주문 ID, 상태, 소계, 할인액, 최종 금액, 생성 시간
   - 전체 주문 수, 페이지 정보
4. 고객이 주문 목록 확인

**대체 흐름**:
- 2a. 고객이 특정 페이지 선택
  - 시스템이 해당 페이지의 주문 목록 조회

**사후 조건**:
- 고객이 자신의 주문 목록을 페이지 단위로 확인
- 다음 단계: UC-013 (주문 상세 조회)

**관련 API**:
- `GET /api/orders?page={page}&size={size}&status={status}`

---

## 쿠폰 관리 유스케이스

### UC-015: 쿠폰 발급

**유스케이스 ID**: UC-015
**제목**: 쿠폰 발급 (선착순)
**액터**: 고객
**목표**: 한정된 수량의 쿠폰을 선착순으로 받기

**사전 조건**:
- 발급 가능한 쿠폰이 시스템에 존재함
- 쿠폰이 남음 (소진되지 않음)
- 쿠폰이 유효기간 내임
- 쿠폰이 활성화 상태임
- 고객이 해당 쿠폰을 아직 받지 않음

**주요 흐름**:
1. 고객이 "쿠폰 받기" 또는 "쿠폰 발급" 버튼 클릭
2. 시스템이 쿠폰 유효성 검증:
   - 쿠폰이 활성화 상태인가?
   - 유효기간이 지나지 않았는가?
   - 남은 쿠폰이 있는가?
   - 이미 발급받지 않았는가?
3. 시스템이 쿠폰 발급:
   - 남은 발급 수량 감소
   - 사용자에게 쿠폰 할당
4. 시스템이 쿠폰 정보 반환:
   - 쿠폰명, 할인 방식 (고정액/비율), 할인액 또는 할인율
   - 유효기간
5. 고객이 쿠폰 발급 완료 알림 수신

**예외 흐름**:
- 2a. 쿠폰이 활성화되지 않음
  - 시스템이 오류 메시지 반환: "쿠폰이 비활성화되어 있습니다"
- 2b. 유효기간이 지남
  - 시스템이 오류 메시지 반환: "쿠폰이 유효기간을 벗어났습니다"
- 2c. 모든 쿠폰 소진
  - 시스템이 오류 메시지 반환: "쿠폰이 모두 소진되었습니다"
- 2d. 이미 발급받은 쿠폰
  - 시스템이 오류 메시지 반환: "이 쿠폰은 이미 발급받으셨습니다"

**사후 조건**:
- 쿠폰이 고객에게 발급됨 (사용 가능 상태)
- 다음 단계: UC-016 (쿠폰 조회), UC-008 (주문 시 쿠폰 적용)

**관련 API**:
- `POST /api/coupons/issue`

---

### UC-016: 보유 쿠폰 조회

**유스케이스 ID**: UC-016
**제목**: 사용자가 보유한 쿠폰 조회
**액터**: 고객
**목표**: 내가 보유한 쿠폰들을 확인하고 사용 가능한 것들 파악

**사전 조건**:
- 고객이 UC-015를 통해 쿠폰을 발급받음
- 보유한 쿠폰이 존재함

**주요 흐름**:
1. 고객이 "내 쿠폰" 또는 "쿠폰 목록" 메뉴 선택
2. 시스템이 고객이 보유한 쿠폰 조회:
   - 기본값: 사용 가능한 쿠폰 (활성 상태)
   - 상태 필터 (선택): 활성, 사용됨, 만료됨
3. 시스템이 쿠폰 목록 반환:
   - 각 쿠폰: 쿠폰명, 할인 방식 (고정액/비율), 할인액 또는 할인율
   - 상태, 발급일, 유효기간
4. 고객이 보유 쿠폰 확인

**대체 흐름**:
- 2a. 상태 필터 지정 없음
  - 활성 상태의 쿠폰만 조회 (기본값)

**사후 조건**:
- 고객이 보유 쿠폰 목록 확인
- 사용 가능한 쿠폰이 무엇인지 파악
- 다음 단계: UC-008 (주문 시 쿠폰 적용)

**관련 API**:
- `GET /api/coupons/issued?status={status}`

---

### UC-017: 사용 가능한 쿠폰 조회

**유스케이스 ID**: UC-017
**제목**: 사용 가능한 쿠폰 조회
**액터**: 고객
**목표**: 발급받을 수 있는 쿠폰들을 확인하고 발급받기

**사전 조건**:
- 시스템에 발급 가능한 쿠폰이 존재함

**주요 흐름**:
1. 고객이 "쿠폰 받기" 또는 "사용 가능한 쿠폰" 메뉴 선택
2. 시스템이 발급 가능한 쿠폰 목록 조회:
   - 활성화 상태인가?
   - 유효기간이 지나지 않았는가?
   - 남은 쿠폰이 있는가?
3. 시스템이 쿠폰 목록 반환:
   - 쿠폰명, 설명, 할인 방식, 할인액 또는 할인율
   - 유효기간, 남은 쿠폰 수량
4. 고객이 발급 가능한 쿠폰 확인 및 선택

**사후 조건**:
- 고객이 발급 가능한 쿠폰 목록 확인
- 다음 단계: UC-015 (쿠폰 발급)

**관련 API**:
- `GET /api/coupons`

---

## 예외 처리 유스케이스

### UC-009: 재고 부족 오류

**유스케이스 ID**: UC-009
**제목**: 재고 부족 처리
**액터**: 고객, 시스템
**목표**: 주문 시 재고 부족 상황을 사용자에게 알리고 다른 옵션 선택 유도

**확장 지점**: UC-008 (주문 생성) - 검증 단계

**트리거**: 옵션별 재고 < 주문 수량

**주요 흐름**:
1. 시스템이 재고 부족 감지
2. 시스템이 오류 메시지 생성:
   - "옵션명의 재고가 부족합니다"
   - 현재 재고, 요청 수량 정보 제시
3. 시스템이 HTTP 400 응답 (오류 코드: ERR-001)
4. 프론트엔드가 오류 메시지를 사용자 친화적으로 표시
5. 고객이 다음 행동 선택:
   - 5a. 수량 조정 → UC-006 (수량 수정)
   - 5b. 다른 옵션 선택 → UC-002 (상품 상세 조회)로 복귀
   - 5c. 장바구니 확인 → UC-004 (장바구니 조회)

**사후 조건**:
- 주문이 생성되지 않음
- 재고, 잔액 변경 없음

**관련 에러 코드**:
- ERR-001: 재고 부족

---

### UC-010: 잔액 부족 오류

**유스케이스 ID**: UC-010
**제목**: 잔액 부족 처리
**액터**: 고객, 시스템
**목표**: 잔액 부족으로 인한 결제 실패를 알리고 대안 제시

**확장 지점**: UC-008 (주문 생성) - 검증 단계

**트리거**: 고객 잔액 < 최종 결제금액

**주요 흐름**:
1. 시스템이 잔액 부족 감지
2. 시스템이 오류 메시지 생성:
   - "잔액이 부족합니다"
   - 필요한 금액, 현재 잔액, 부족 금액 정보 제시
3. 시스템이 HTTP 400 응답 (오류 코드: ERR-002)
4. 프론트엔드가 오류 메시지 및 충전 안내 표시
5. 고객이 다음 행동 선택:
   - 5a. 잔액 충전 (별도 시스템)
   - 5b. 주문 수량 조정 → UC-006 (수량 수정)
   - 5c. 쿠폰 선택 → UC-016 (쿠폰 조회)

**사후 조건**:
- 주문이 생성되지 않음
- 재고, 잔액 변경 없음

**관련 에러 코드**:
- ERR-002: 잔액 부족

---

### UC-011: 쿠폰 무효 오류

**유스케이스 ID**: UC-011
**제목**: 쿠폰 무효 처리
**액터**: 고객, 시스템
**목표**: 쿠폰이 유효하지 않은 이유를 사용자에게 알림

**확장 지점**: UC-008 (주문 생성) - 검증 단계 또는 UC-015 (쿠폰 발급)

**트리거**: 쿠폰이 유효하지 않음

**주요 흐름**:
1. 시스템이 쿠폰 무효 원인 파악:
   - 쿠폰이 존재하지 않음
   - 유효기간이 지남
   - 이미 사용됨
   - 활성화되지 않음
   - 남은 쿠폰 없음 (발급 단계)
2. 시스템이 원인에 맞는 오류 메시지 생성
3. 시스템이 HTTP 400 응답 (오류 코드: ERR-003)
4. 프론트엔드가 오류 메시지 표시
5. 고객이 다음 행동 선택:
   - 5a. 쿠폰 선택 해제 → UC-008 (주문) 재시도
   - 5b. 다른 쿠폰 선택 → UC-016 (쿠폰 조회) 또는 UC-017
   - 5c. 계속 진행 (쿠폰 미적용) → UC-008 재시도

**사후 조건**:
- 주문이 생성되지 않음 (주문 시점의 오류인 경우)
- 쿠폰 상태 변경 없음

**관련 에러 코드**:
- ERR-003: 쿠폰 무효

---

### UC-012: 동시 주문 충돌

**유스케이스 ID**: UC-012
**제목**: 동시 주문 충돌 처리
**액터**: 고객, 시스템
**목표**: 다른 고객의 주문으로 인한 재고 변경을 감지하고 재시도 유도

**확장 지점**: UC-008 (주문 생성) - 거래 처리 단계

**트리거**: 두 명 이상의 고객이 동일한 재고를 놓고 동시에 주문

**시나리오**:
- 고객 A와 B가 동시에 마지막 1개 재고를 주문
- 고객 A의 주문이 먼저 완료
- 고객 B의 주문이 실패 (재고 변경 감지)

**주요 흐름**:
1. 시스템이 다른 거래에 의한 재고 변경 감지
2. 시스템이 현재 거래 취소 (롤백)
3. 시스템이 오류 메시지 생성:
   - "다른 고객이 먼저 구매하여 재고가 변경되었습니다"
4. 시스템이 HTTP 500 응답 (오류 코드: ERR-004)
5. 프론트엔드가 오류 메시지 표시 및 자동 새로고침 (3초 후)
6. 고객이 최신 재고 상태 확인
7. 고객이 다시 주문 시도:
   - 7a. 재고가 남음 → UC-008 재시도
   - 7b. 재고가 없음 → UC-009 (재고 부족 오류) 처리

**사후 조건**:
- 고객 B의 주문이 생성되지 않음
- 재고, 잔액 변경 없음 (완전히 취소됨)

**관련 에러 코드**:
- ERR-004: 거래 실패 (동시 충돌)

---

## 부록 A: 유스케이스 ID 색인

| 유스케이스 ID | 제목 | 액터 |
|------------|------|------|
| UC-001 | 상품 목록 조회 | 고객 |
| UC-002 | 상품 상세 조회 | 고객 |
| UC-003 | 인기 상품 조회 | 고객 |
| UC-004 | 장바구니 조회 | 고객 |
| UC-005 | 장바구니 아이템 추가 | 고객 |
| UC-006 | 장바구니 아이템 수량 수정 | 고객 |
| UC-007 | 장바구니 아이템 제거 | 고객 |
| UC-008 | 주문 생성 | 고객 |
| UC-013 | 주문 상세 조회 | 고객 |
| UC-014 | 주문 목록 조회 | 고객 |
| UC-015 | 쿠폰 발급 | 고객 |
| UC-016 | 보유 쿠폰 조회 | 고객 |
| UC-017 | 사용 가능한 쿠폰 조회 | 고객 |
| UC-009 | 재고 부족 오류 | 고객, 시스템 |
| UC-010 | 잔액 부족 오류 | 고객, 시스템 |
| UC-011 | 쿠폰 무효 오류 | 고객, 시스템 |
| UC-012 | 동시 주문 충돌 | 고객, 시스템 |

---

## 부록 B: API 엔드포인트 매핑

| 유스케이스 ID | 제목 | API 엔드포인트 | HTTP 메서드 |
|------------|------|--------------|----------|
| UC-001 | 상품 목록 조회 | /api/products | GET |
| UC-002 | 상품 상세 조회 | /api/products/{product_id} | GET |
| UC-003 | 인기 상품 조회 | /api/products/popular | GET |
| UC-004 | 장바구니 조회 | /api/carts | GET |
| UC-005 | 장바구니 아이템 추가 | /api/carts/items | POST |
| UC-006 | 장바구니 아이템 수량 수정 | /api/carts/items/{cart_item_id} | PUT |
| UC-007 | 장바구니 아이템 제거 | /api/carts/items/{cart_item_id} | DELETE |
| UC-008 | 주문 생성 | /api/orders | POST |
| UC-013 | 주문 상세 조회 | /api/orders/{order_id} | GET |
| UC-014 | 주문 목록 조회 | /api/orders | GET |
| UC-015 | 쿠폰 발급 | /api/coupons/issue | POST |
| UC-016 | 보유 쿠폰 조회 | /api/coupons/issued | GET |
| UC-017 | 사용 가능한 쿠폰 조회 | /api/coupons | GET |

---

## 부록 C: 유스케이스 플로우 맵

```
상품 조회
├── UC-001: 상품 목록 조회
│   └── UC-002: 상품 상세 조회
│       └── UC-003: 인기 상품 조회 (대안)
│
장바구니 관리
├── UC-004: 장바구니 조회
├── UC-005: 장바구니 아이템 추가
│   └── 반복: UC-005, UC-006, UC-007 가능
├── UC-006: 장바구니 아이템 수량 수정
├── UC-007: 장바구니 아이템 제거
│
쿠폰 (선택)
├── UC-015: 쿠폰 발급
│   └── UC-017: 사용 가능한 쿠폰 조회
├── UC-016: 보유 쿠폰 조회
│
주문
└── UC-008: 주문 생성
    ├── 예외: UC-009 (재고 부족)
    ├── 예외: UC-010 (잔액 부족)
    ├── 예외: UC-011 (쿠폰 무효)
    ├── 예외: UC-012 (동시 충돌)
    └── 성공 후: UC-013/UC-014 (주문 조회)
```

---

## 부록 D: 주요 비즈니스 규칙

| 규칙 | 설명 | 관련 유스케이스 |
|-----|------|--------------|
| 옵션별 재고 관리 | 상품 총 재고가 아닌 **옵션별 재고** 기준으로 판단 | UC-002, UC-005, UC-008 |
| 장바구니 무결성 | 장바구니 추가 시 **재고 차감 없음** (주문 시점에만) | UC-005, UC-007 |
| 원자적 거래 | 주문 시 재고/잔액/쿠폰 모두를 **하나의 거래**로 처리 | UC-008 |
| 선착순 발급 | 쿠폰은 **정해진 수량만큼만** 발급 (초과 발급 방지) | UC-015 |
| 부분 주문 불가 | 재고 부족 시 **일부만 주문 불가** (전부 또는 전무) | UC-008, UC-009 |

---

## 부록 E: 참고 문서

- `api-specification.md` - REST API 엔드포인트 상세 정의
- `requirements.md` - 기능 및 비기능 요구사항
- `data-models.md` - 데이터베이스 모델 및 제약조건
- `use-case-design-evaluation.md` - 유스케이스 중심 설계 평가 보고서
